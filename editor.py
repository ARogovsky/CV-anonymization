from reportlab.pdfgen import canvas
from PyPDF2 import PdfReader, PdfWriter
from pdf2image import convert_from_path
import cv2
import pytesseract
import fitz
import os
import numpy as np


project_path = os.getcwd()

def search_files(folder_path, extension):
    found_files = []

    try:
        # Проход через все файлы в указанной папке
        for file in os.listdir(folder_path):
            # Проверка расширения файла
            if file.endswith(extension):
                # Добавление только имени файла в список
                found_files.append(file)
    except Exception as e:
        print(f"Ошибка при поиске файлов: {e}")

    return found_files

# Укажите путь к папке и расширение файлов, которые вы ищете
folder_path = 'IMG/INPUT'
file_extension = '.pdf'  # Например, для поиска текстовых файлов

# Вызов функции поиска файлов
result = search_files(folder_path, file_extension)

# Вывод найденных файлов (только имена)
if result:

    print("Найденные файлы:")
    for found_file_name in result:

        file_name = found_file_name[:-4]
        input_pdf_path = f"IMG/INPUT/{file_name}.pdf"
        output_pdf_path = f"IMG/INPUT/{file_name}.pdf"
        save_pdf = f"IMG/INPUT/{file_name}.png"
        name_extracrtedPage = f"{file_name}.png"
        text_to_add = f"{file_name}@example.com"

        images = convert_from_path(input_pdf_path, first_page=0, last_page=0, poppler_path=r'C:/Program Files (x86)/poppler-23.11.0/Library/bin')

        image = images[0]  # Получаем только первое изображение
        image.save(save_pdf, "PNG")

        pytesseract.pytesseract.tesseract_cmd = f'{project_path}/Tesseract-OCR/tesseract.exe'
        x_paste = 0
        y_paste = 0
        phone_x_paste = 0
        phone_y_paste = 0
        e_mail_x_paste = 0
        e_mail_y_paste = 0
        ko_vo_of_founded_elems = 0
        phone_number = ['10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21', '22', '23', '24', '25',
                        '26', '27', '28', '29', '30', '31', '32', '33', '34', '35', '36', '37', '38', '39', '40', '41',
                        '42', '43', '44', '45', '46', '47', '48', '49', '50', '51', '52', '53', '54', '55', '56', '57',
                        '58', '59', '60', '61', '62', '63', '64', '65', '66', '67', '68', '69', '70', '71', '72', '73',
                        '74', '75', '76', '77', '78', '79', '80', '81', '82', '83', '84', '85', '86', '87', '88', '89',
                        '90', '91', '92', '93', '94', '95', '96', '97', '98', '99', '100', '101', '102', '103', '104',
                        '105', '106', '107', '108', '109', '110', '111', '112', '113', '114', '115', '116', '117',
                        '118', '119', '120', '121', '122', '123', '124', '125', '126', '127', '128', '129', '130',
                        '131', '132', '133', '134', '135', '136', '137', '138', '139', '140', '141', '142', '143',
                        '144', '145', '146', '147', '148', '149', '150', '151', '152', '153', '154', '155', '156',
                        '157', '158', '159', '160', '161', '162', '163', '164', '165', '166', '167', '168', '169',
                        '170', '171', '172', '173', '174', '175', '176', '177', '178', '179', '180', '181', '182',
                        '183', '184', '185', '186', '187', '188', '189', '190', '191', '192', '193', '194', '195',
                        '196', '197', '198', '199', '200', '201', '202', '203', '204', '205', '206', '207', '208',
                        '209', '210', '211', '212', '213', '214', '215', '216', '217', '218', '219', '220', '221',
                        '222', '223', '224', '225', '226', '227', '228', '229', '230', '231', '232', '233', '234',
                        '235', '236', '237', '238', '239', '240', '241', '242', '243', '244', '245', '246', '247',
                        '248', '249', '250', '251', '252', '253', '254', '255', '256', '257', '258', '259', '260',
                        '261', '262', '263', '264', '265', '266', '267', '268', '269', '270', '271', '272', '273',
                        '274', '275', '276', '277', '278', '279', '280', '281', '282', '283', '284', '285', '286',
                        '287', '288', '289', '290', '291', '292', '293', '294', '295', '296', '297', '298', '299',
                        '300', '301', '302', '303', '304', '305', '306', '307', '308', '309', '310', '311', '312',
                        '313', '314', '315', '316', '317', '318', '319', '320', '321', '322', '323', '324', '325',
                        '326', '327', '328', '329', '330', '331', '332', '333', '334', '335', '336', '337', '338',
                        '339', '340', '341', '342', '343', '344', '345', '346', '347', '348', '349', '350', '351',
                        '352', '353', '354', '355', '356', '357', '358', '359', '360', '361', '362', '363', '364',
                        '365', '366', '367', '368', '369', '370', '371', '372', '373', '374', '375', '376', '377',
                        '378', '379', '380', '381', '382', '383', '384', '385', '386', '387', '388', '389', '390',
                        '391', '392', '393', '394', '395', '396', '397', '398', '399', '400', '401', '402', '403',
                        '404', '405', '406', '407', '408', '409', '410', '411', '412', '413', '414', '415', '416',
                        '417', '418', '419', '420', '421', '422', '423', '424', '425', '426', '427', '428', '429',
                        '430', '431', '432', '433', '434', '435', '436', '437', '438', '439', '440', '441', '442',
                        '443', '444', '445', '446', '447', '448', '449', '450', '451', '452', '453', '454', '455',
                        '456', '457', '458', '459', '460', '461', '462', '463', '464', '465', '466', '467', '468',
                        '469', '470', '471', '472', '473', '474', '475', '476', '477', '478', '479', '480', '481',
                        '482', '483', '484', '485', '486', '487', '488', '489', '490', '491', '492', '493', '494',
                        '495', '496', '497', '498', '499', '500', '501', '502', '503', '504', '505', '506', '507',
                        '508', '509', '510', '511', '512', '513', '514', '515', '516', '517', '518', '519', '520',
                        '521', '522', '523', '524', '525', '526', '527', '528', '529', '530', '531', '532', '533',
                        '534', '535', '536', '537', '538', '539', '540', '541', '542', '543', '544', '545', '546',
                        '547', '548', '549', '550', '551', '552', '553', '554', '555', '556', '557', '558', '559',
                        '560', '561', '562', '563', '564', '565', '566', '567', '568', '569', '570', '571', '572',
                        '573', '574', '575', '576', '577', '578', '579', '580', '581', '582', '583', '584', '585',
                        '586', '587', '588', '589', '590', '591', '592', '593', '594', '595', '596', '597', '598',
                        '599', '600', '601', '602', '603', '604', '605', '606', '607', '608', '609', '610', '611',
                        '612', '613', '614', '615', '616', '617', '618', '619', '620', '621', '622', '623', '624',
                        '625', '626', '627', '628', '629', '630', '631', '632', '633', '634', '635', '636', '637',
                        '638', '639', '640', '641', '642', '643', '644', '645', '646', '647', '648', '649', '650',
                        '651', '652', '653', '654', '655', '656', '657', '658', '659', '660', '661', '662', '663',
                        '664', '665', '666', '667', '668', '669', '670', '671', '672', '673', '674', '675', '676',
                        '677', '678', '679', '680', '681', '682', '683', '684', '685', '686', '687', '688', '689',
                        '690', '691', '692', '693', '694', '695', '696', '697', '698', '699', '700', '701', '702',
                        '703', '704', '705', '706', '707', '708', '709', '710', '711', '712', '713', '714', '715',
                        '716', '717', '718', '719', '720', '721', '722', '723', '724', '725', '726', '727', '728',
                        '729', '730', '731', '732', '733', '734', '735', '736', '737', '738', '739', '740', '741',
                        '742', '743', '744', '745', '746', '747', '748', '749', '750', '751', '752', '753', '754',
                        '755', '756', '757', '758', '759', '760', '761', '762', '763', '764', '765', '766', '767',
                        '768', '769', '770', '771', '772', '773', '774', '775', '776', '777', '778', '779', '780',
                        '781', '782', '783', '784', '785', '786', '787', '788', '789', '790', '791', '792', '793',
                        '794', '795', '796', '797', '798', '799', '800', '801', '802', '803', '804', '805', '806',
                        '807', '808', '809', '810', '811', '812', '813', '814', '815', '816', '817', '818', '819',
                        '820', '821', '822', '823', '824', '825', '826', '827', '828', '829', '830', '831', '832',
                        '833', '834', '835', '836', '837', '838', '839', '840', '841', '842', '843', '844', '845',
                        '846', '847', '848', '849', '850', '851', '852', '853', '854', '855', '856', '857', '858',
                        '859', '860', '861', '862', '863', '864', '865', '866', '867', '868', '869', '870', '871',
                        '872', '873', '874', '875', '876', '877', '878', '879', '880', '881', '882', '883', '884',
                        '885', '886', '887', '888', '889', '890', '891', '892', '893', '894', '895', '896', '897',
                        '898', '899', '900', '901', '902', '903', '904', '905', '906', '907', '908', '909', '910',
                        '911', '912', '913', '914', '915', '916', '917', '918', '919', '920', '921', '922', '923',
                        '924', '925', '926', '927', '928', '929', '930', '931', '932', '933', '934', '935', '936',
                        '937', '938', '939', '940', '941', '942', '943', '944', '945', '946', '947', '948', '949',
                        '950', '951', '952', '953', '954', '955', '956', '957', '958', '959', '960', '961', '962',
                        '963', '964', '965', '966', '967', '968', '969', '970', '971', '972', '973', '974', '975',
                        '976', '977', '978', '979', '980', '981', '982', '983', '984', '985', '986', '987', '988',
                        '989', '990', '991', '992', '993', '994', '995', '996', '997', '998', '999', '+0', '+1', '+2',
                        '+3', '+4', '+5', '+6', '+7', '+8', '+9', '+10', '+11', '+12', '+13', '+14', '+15', '+16',
                        '+17', '+18', '+19', '+20', '+21', '+22', '+23', '+24', '+25', '+26', '+27', '+28', '+29',
                        '+30', '+31', '+32', '+33', '+34', '+35', '+36', '+37', '+38', '+39', '+40', '+41', '+42',
                        '+43', '+44', '+45', '+46', '+47', '+48', '+49', '+50', '+51', '+52', '+53', '+54', '+55',
                        '+56', '+57', '+58', '+59', '+60', '+61', '+62', '+63', '+64', '+65', '+66', '+67', '+68',
                        '+69', '+70', '+71', '+72', '+73', '+74', '+75', '+76', '+77', '+78', '+79', '+80', '+81',
                        '+82', '+83', '+84', '+85', '+86', '+87', '+88', '+89', '+90', '+91', '+92', '+93', '+94',
                        '+95', '+96', '+97', '+98', '+99', '+100', '+101', '+102', '+103', '+104', '+105', '+106',
                        '+107', '+108', '+109', '+110', '+111', '+112', '+113', '+114', '+115', '+116', '+117', '+118',
                        '+119', '+120', '+121', '+122', '+123', '+124', '+125', '+126', '+127', '+128', '+129', '+130',
                        '+131', '+132', '+133', '+134', '+135', '+136', '+137', '+138', '+139', '+140', '+141', '+142',
                        '+143', '+144', '+145', '+146', '+147', '+148', '+149', '+150', '+151', '+152', '+153', '+154',
                        '+155', '+156', '+157', '+158', '+159', '+160', '+161', '+162', '+163', '+164', '+165', '+166',
                        '+167', '+168', '+169', '+170', '+171', '+172', '+173', '+174', '+175', '+176', '+177', '+178',
                        '+179', '+180', '+181', '+182', '+183', '+184', '+185', '+186', '+187', '+188', '+189', '+190',
                        '+191', '+192', '+193', '+194', '+195', '+196', '+197', '+198', '+199', '+200', '+201', '+202',
                        '+203', '+204', '+205', '+206', '+207', '+208', '+209', '+210', '+211', '+212', '+213', '+214',
                        '+215', '+216', '+217', '+218', '+219', '+220', '+221', '+222', '+223', '+224', '+225', '+226',
                        '+227', '+228', '+229', '+230', '+231', '+232', '+233', '+234', '+235', '+236', '+237', '+238',
                        '+239', '+240', '+241', '+242', '+243', '+244', '+245', '+246', '+247', '+248', '+249', '+250',
                        '+251', '+252', '+253', '+254', '+255', '+256', '+257', '+258', '+259', '+260', '+261', '+262',
                        '+263', '+264', '+265', '+266', '+267', '+268', '+269', '+270', '+271', '+272', '+273', '+274',
                        '+275', '+276', '+277', '+278', '+279', '+280', '+281', '+282', '+283', '+284', '+285', '+286',
                        '+287', '+288', '+289', '+290', '+291', '+292', '+293', '+294', '+295', '+296', '+297', '+298',
                        '+299', '+300', '+301', '+302', '+303', '+304', '+305', '+306', '+307', '+308', '+309', '+310',
                        '+311', '+312', '+313', '+314', '+315', '+316', '+317', '+318', '+319', '+320', '+321', '+322',
                        '+323', '+324', '+325', '+326', '+327', '+328', '+329', '+330', '+331', '+332', '+333', '+334',
                        '+335', '+336', '+337', '+338', '+339', '+340', '+341', '+342', '+343', '+344', '+345', '+346',
                        '+347', '+348', '+349', '+350', '+351', '+352', '+353', '+354', '+355', '+356', '+357', '+358',
                        '+359', '+360', '+361', '+362', '+363', '+364', '+365', '+366', '+367', '+368', '+369', '+370',
                        '+371', '+372', '+373', '+374', '+375', '+376', '+377', '+378', '+379', '+380', '+381', '+382',
                        '+383', '+384', '+385', '+386', '+387', '+388', '+389', '+390', '+391', '+392', '+393', '+394',
                        '+395', '+396', '+397', '+398', '+399', '+400', '+401', '+402', '+403', '+404', '+405', '+406',
                        '+407', '+408', '+409', '+410', '+411', '+412', '+413', '+414', '+415', '+416', '+417', '+418',
                        '+419', '+420', '+421', '+422', '+423', '+424', '+425', '+426', '+427', '+428', '+429', '+430',
                        '+431', '+432', '+433', '+434', '+435', '+436', '+437', '+438', '+439', '+440', '+441', '+442',
                        '+443', '+444', '+445', '+446', '+447', '+448', '+449', '+450', '+451', '+452', '+453', '+454',
                        '+455', '+456', '+457', '+458', '+459', '+460', '+461', '+462', '+463', '+464', '+465', '+466',
                        '+467', '+468', '+469', '+470', '+471', '+472', '+473', '+474', '+475', '+476', '+477', '+478',
                        '+479', '+480', '+481', '+482', '+483', '+484', '+485', '+486', '+487', '+488', '+489', '+490',
                        '+491', '+492', '+493', '+494', '+495', '+496', '+497', '+498', '+499', '+500', '+501', '+502',
                        '+503', '+504', '+505', '+506', '+507', '+508', '+509', '+510', '+511', '+512', '+513', '+514',
                        '+515', '+516', '+517', '+518', '+519', '+520', '+521', '+522', '+523', '+524', '+525', '+526',
                        '+527', '+528', '+529', '+530', '+531', '+532', '+533', '+534', '+535', '+536', '+537', '+538',
                        '+539', '+540', '+541', '+542', '+543', '+544', '+545', '+546', '+547', '+548', '+549', '+550',
                        '+551', '+552', '+553', '+554', '+555', '+556', '+557', '+558', '+559', '+560', '+561', '+562',
                        '+563', '+564', '+565', '+566', '+567', '+568', '+569', '+570', '+571', '+572', '+573', '+574',
                        '+575', '+576', '+577', '+578', '+579', '+580', '+581', '+582', '+583', '+584', '+585', '+586',
                        '+587', '+588', '+589', '+590', '+591', '+592', '+593', '+594', '+595', '+596', '+597', '+598',
                        '+599', '+600', '+601', '+602', '+603', '+604', '+605', '+606', '+607', '+608', '+609', '+610',
                        '+611', '+612', '+613', '+614', '+615', '+616', '+617', '+618', '+619', '+620', '+621', '+622',
                        '+623', '+624', '+625', '+626', '+627', '+628', '+629', '+630', '+631', '+632', '+633', '+634',
                        '+635', '+636', '+637', '+638', '+639', '+640', '+641', '+642', '+643', '+644', '+645', '+646',
                        '+647', '+648', '+649', '+650', '+651', '+652', '+653', '+654', '+655', '+656', '+657', '+658',
                        '+659', '+660', '+661', '+662', '+663', '+664', '+665', '+666', '+667', '+668', '+669', '+670',
                        '+671', '+672', '+673', '+674', '+675', '+676', '+677', '+678', '+679', '+680', '+681', '+682',
                        '+683', '+684', '+685', '+686', '+687', '+688', '+689', '+690', '+691', '+692', '+693', '+694',
                        '+695', '+696', '+697', '+698', '+699', '+700', '+701', '+702', '+703', '+704', '+705', '+706',
                        '+707', '+708', '+709', '+710', '+711', '+712', '+713', '+714', '+715', '+716', '+717', '+718',
                        '+719', '+720', '+721', '+722', '+723', '+724', '+725', '+726', '+727', '+728', '+729', '+730',
                        '+731', '+732', '+733', '+734', '+735', '+736', '+737', '+738', '+739', '+740', '+741', '+742',
                        '+743', '+744', '+745', '+746', '+747', '+748', '+749', '+750', '+751', '+752', '+753', '+754',
                        '+755', '+756', '+757', '+758', '+759', '+760', '+761', '+762', '+763', '+764', '+765', '+766',
                        '+767', '+768', '+769', '+770', '+771', '+772', '+773', '+774', '+775', '+776', '+777', '+778',
                        '+779', '+780', '+781', '+782', '+783', '+784', '+785', '+786', '+787', '+788', '+789', '+790',
                        '+791', '+792', '+793', '+794', '+795', '+796', '+797', '+798', '+799', '+800', '+801', '+802',
                        '+803', '+804', '+805', '+806', '+807', '+808', '+809', '+810', '+811', '+812', '+813', '+814',
                        '+815', '+816', '+817', '+818', '+819', '+820', '+821', '+822', '+823', '+824', '+825', '+826',
                        '+827', '+828', '+829', '+830', '+831', '+832', '+833', '+834', '+835', '+836', '+837', '+838',
                        '+839', '+840', '+841', '+842', '+843', '+844', '+845', '+846', '+847', '+848', '+849', '+850',
                        '+851', '+852', '+853', '+854', '+855', '+856', '+857', '+858', '+859', '+860', '+861', '+862',
                        '+863', '+864', '+865', '+866', '+867', '+868', '+869', '+870', '+871', '+872', '+873', '+874',
                        '+875', '+876', '+877', '+878', '+879', '+880', '+881', '+882', '+883', '+884', '+885', '+886',
                        '+887', '+888', '+889', '+890', '+891', '+892', '+893', '+894', '+895', '+896', '+897', '+898',
                        '+899', '+900', '+901', '+902', '+903', '+904', '+905', '+906', '+907', '+908', '+909', '+910',
                        '+911', '+912', '+913', '+914', '+915', '+916', '+917', '+918', '+919', '+920', '+921', '+922',
                        '+923', '+924', '+925', '+926', '+927', '+928', '+929', '+930', '+931', '+932', '+933', '+934',
                        '+935', '+936', '+937', '+938', '+939', '+940', '+941', '+942', '+943', '+944', '+945', '+946',
                        '+947', '+948', '+949', '+950', '+951', '+952', '+953', '+954', '+955', '+956', '+957', '+958',
                        '+959', '+960', '+961', '+962', '+963', '+964', '+965', '+966', '+967', '+968', '+969', '+970',
                        '+971', '+972', '+973', '+974', '+975', '+976', '+977', '+978', '+979', '+980', '+981', '+982',
                        '+983', '+984', '+985', '+986', '+987', '+988', '+989', '+990', '+991', '+992', '+993', '+994',
                        '+995', '+996', '+997', '+998', '+999', '01', '02', '03', '04', '05', '06', '07', '08', '09',
                        '010', '011', '012', '013', '014', '015', '016', '017', '018', '019', '020', '021', '022',
                        '023', '024', '025', '026', '027', '028', '029', '030', '031', '032', '033', '034', '035',
                        '036', '037', '038', '039', '040', '041', '042', '043', '044', '045', '046', '047', '048',
                        '049', '050', '051', '052', '053', '054', '055', '056', '057', '058', '059', '060', '061',
                        '062', '063', '064', '065', '066', '067', '068', '069', '070', '071', '072', '073', '074',
                        '075', '076', '077', '078', '079', '080', '081', '082', '083', '084', '085', '086', '087',
                        '088', '089', '090', '091', '092', '093', '094', '095', '096', '097', '098', '099', '0100',
                        '0101', '0102', '0103', '0104', '0105', '0106', '0107', '0108', '0109', '0110', '0111', '0112',
                        '0113', '0114', '0115', '0116', '0117', '0118', '0119', '0120', '0121', '0122', '0123', '0124',
                        '0125', '0126', '0127', '0128', '0129', '0130', '0131', '0132', '0133', '0134', '0135', '0136',
                        '0137', '0138', '0139', '0140', '0141', '0142', '0143', '0144', '0145', '0146', '0147', '0148',
                        '0149', '0150', '0151', '0152', '0153', '0154', '0155', '0156', '0157', '0158', '0159', '0160',
                        '0161', '0162', '0163', '0164', '0165', '0166', '0167', '0168', '0169', '0170', '0171', '0172',
                        '0173', '0174', '0175', '0176', '0177', '0178', '0179', '0180', '0181', '0182', '0183', '0184',
                        '0185', '0186', '0187', '0188', '0189', '0190', '0191', '0192', '0193', '0194', '0195', '0196',
                        '0197', '0198', '0199', '0200', '0201', '0202', '0203', '0204', '0205', '0206', '0207', '0208',
                        '0209', '0210', '0211', '0212', '0213', '0214', '0215', '0216', '0217', '0218', '0219', '0220',
                        '0221', '0222', '0223', '0224', '0225', '0226', '0227', '0228', '0229', '0230', '0231', '0232',
                        '0233', '0234', '0235', '0236', '0237', '0238', '0239', '0240', '0241', '0242', '0243', '0244',
                        '0245', '0246', '0247', '0248', '0249', '0250', '0251', '0252', '0253', '0254', '0255', '0256',
                        '0257', '0258', '0259', '0260', '0261', '0262', '0263', '0264', '0265', '0266', '0267', '0268',
                        '0269', '0270', '0271', '0272', '0273', '0274', '0275', '0276', '0277', '0278', '0279', '0280',
                        '0281', '0282', '0283', '0284', '0285', '0286', '0287', '0288', '0289', '0290', '0291', '0292',
                        '0293', '0294', '0295', '0296', '0297', '0298', '0299', '0300', '0301', '0302', '0303', '0304',
                        '0305', '0306', '0307', '0308', '0309', '0310', '0311', '0312', '0313', '0314', '0315', '0316',
                        '0317', '0318', '0319', '0320', '0321', '0322', '0323', '0324', '0325', '0326', '0327', '0328',
                        '0329', '0330', '0331', '0332', '0333', '0334', '0335', '0336', '0337', '0338', '0339', '0340',
                        '0341', '0342', '0343', '0344', '0345', '0346', '0347', '0348', '0349', '0350', '0351', '0352',
                        '0353', '0354', '0355', '0356', '0357', '0358', '0359', '0360', '0361', '0362', '0363', '0364',
                        '0365', '0366', '0367', '0368', '0369', '0370', '0371', '0372', '0373', '0374', '0375', '0376',
                        '0377', '0378', '0379', '0380', '0381', '0382', '0383', '0384', '0385', '0386', '0387', '0388',
                        '0389', '0390', '0391', '0392', '0393', '0394', '0395', '0396', '0397', '0398', '0399', '0400',
                        '0401', '0402', '0403', '0404', '0405', '0406', '0407', '0408', '0409', '0410', '0411', '0412',
                        '0413', '0414', '0415', '0416', '0417', '0418', '0419', '0420', '0421', '0422', '0423', '0424',
                        '0425', '0426', '0427', '0428', '0429', '0430', '0431', '0432', '0433', '0434', '0435', '0436',
                        '0437', '0438', '0439', '0440', '0441', '0442', '0443', '0444', '0445', '0446', '0447', '0448',
                        '0449', '0450', '0451', '0452', '0453', '0454', '0455', '0456', '0457', '0458', '0459', '0460',
                        '0461', '0462', '0463', '0464', '0465', '0466', '0467', '0468', '0469', '0470', '0471', '0472',
                        '0473', '0474', '0475', '0476', '0477', '0478', '0479', '0480', '0481', '0482', '0483', '0484',
                        '0485', '0486', '0487', '0488', '0489', '0490', '0491', '0492', '0493', '0494', '0495', '0496',
                        '0497', '0498', '0499', '0500', '0501', '0502', '0503', '0504', '0505', '0506', '0507', '0508',
                        '0509', '0510', '0511', '0512', '0513', '0514', '0515', '0516', '0517', '0518', '0519', '0520',
                        '0521', '0522', '0523', '0524', '0525', '0526', '0527', '0528', '0529', '0530', '0531', '0532',
                        '0533', '0534', '0535', '0536', '0537', '0538', '0539', '0540', '0541', '0542', '0543', '0544',
                        '0545', '0546', '0547', '0548', '0549', '0550', '0551', '0552', '0553', '0554', '0555', '0556',
                        '0557', '0558', '0559', '0560', '0561', '0562', '0563', '0564', '0565', '0566', '0567', '0568',
                        '0569', '0570', '0571', '0572', '0573', '0574', '0575', '0576', '0577', '0578', '0579', '0580',
                        '0581', '0582', '0583', '0584', '0585', '0586', '0587', '0588', '0589', '0590', '0591', '0592',
                        '0593', '0594', '0595', '0596', '0597', '0598', '0599', '0600', '0601', '0602', '0603', '0604',
                        '0605', '0606', '0607', '0608', '0609', '0610', '0611', '0612', '0613', '0614', '0615', '0616',
                        '0617', '0618', '0619', '0620', '0621', '0622', '0623', '0624', '0625', '0626', '0627', '0628',
                        '0629', '0630', '0631', '0632', '0633', '0634', '0635', '0636', '0637', '0638', '0639', '0640',
                        '0641', '0642', '0643', '0644', '0645', '0646', '0647', '0648', '0649', '0650', '0651', '0652',
                        '0653', '0654', '0655', '0656', '0657', '0658', '0659', '0660', '0661', '0662', '0663', '0664',
                        '0665', '0666', '0667', '0668', '0669', '0670', '0671', '0672', '0673', '0674', '0675', '0676',
                        '0677', '0678', '0679', '0680', '0681', '0682', '0683', '0684', '0685', '0686', '0687', '0688',
                        '0689', '0690', '0691', '0692', '0693', '0694', '0695', '0696', '0697', '0698', '0699', '0700',
                        '0701', '0702', '0703', '0704', '0705', '0706', '0707', '0708', '0709', '0710', '0711', '0712',
                        '0713', '0714', '0715', '0716', '0717', '0718', '0719', '0720', '0721', '0722', '0723', '0724',
                        '0725', '0726', '0727', '0728', '0729', '0730', '0731', '0732', '0733', '0734', '0735', '0736',
                        '0737', '0738', '0739', '0740', '0741', '0742', '0743', '0744', '0745', '0746', '0747', '0748',
                        '0749', '0750', '0751', '0752', '0753', '0754', '0755', '0756', '0757', '0758', '0759', '0760',
                        '0761', '0762', '0763', '0764', '0765', '0766', '0767', '0768', '0769', '0770', '0771', '0772',
                        '0773', '0774', '0775', '0776', '0777', '0778', '0779', '0780', '0781', '0782', '0783', '0784',
                        '0785', '0786', '0787', '0788', '0789', '0790', '0791', '0792', '0793', '0794', '0795', '0796',
                        '0797', '0798', '0799', '0800', '0801', '0802', '0803', '0804', '0805', '0806', '0807', '0808',
                        '0809', '0810', '0811', '0812', '0813', '0814', '0815', '0816', '0817', '0818', '0819', '0820',
                        '0821', '0822', '0823', '0824', '0825', '0826', '0827', '0828', '0829', '0830', '0831', '0832',
                        '0833', '0834', '0835', '0836', '0837', '0838', '0839', '0840', '0841', '0842', '0843', '0844',
                        '0845', '0846', '0847', '0848', '0849', '0850', '0851', '0852', '0853', '0854', '0855', '0856',
                        '0857', '0858', '0859', '0860', '0861', '0862', '0863', '0864', '0865', '0866', '0867', '0868',
                        '0869', '0870', '0871', '0872', '0873', '0874', '0875', '0876', '0877', '0878', '0879', '0880',
                        '0881', '0882', '0883', '0884', '0885', '0886', '0887', '0888', '0889', '0890', '0891', '0892',
                        '0893', '0894', '0895', '0896', '0897', '0898', '0899', '0900', '0901', '0902', '0903', '0904',
                        '0905', '0906', '0907', '0908', '0909', '0910', '0911', '0912', '0913', '0914', '0915', '0916',
                        '0917', '0918', '0919', '0920', '0921', '0922', '0923', '0924', '0925', '0926', '0927', '0928',
                        '0929', '0930', '0931', '0932', '0933', '0934', '0935', '0936', '0937', '0938', '0939', '0940',
                        '0941', '0942', '0943', '0944', '0945', '0946', '0947', '0948', '0949', '0950', '0951', '0952',
                        '0953', '0954', '0955', '0956', '0957', '0958', '0959', '0960', '0961', '0962', '0963', '0964',
                        '0965', '0966', '0967', '0968', '0969', '0970', '0971', '0972', '0973', '0974', '0975', '0976',
                        '0977', '0978', '0979', '0980', '0981', '0982', '0983', '0984', '0985', '0986', '0987', '0988',
                        '0989', '0990', '0991', '0992', '0993', '0994', '0995', '0996', '0997', '0998', '0999']

        img = cv2.imread(f'IMG/INPUT/{name_extracrtedPage}')
        img = cv2.resize(img, (2400, 3600))

        x0 = img.shape[1]
        y0 = img.shape[0]

        faces = cv2.CascadeClassifier('faces.xml')

        result = faces.detectMultiScale(img, scaleFactor=3, minNeighbors=3)

        for (x, y, w, h) in result:
            x_paste = x
            y_paste = y
            area = img[y:y + h, x:x + w]
            area = cv2.flip(area, 1)
            my_size = [x // 3, y // 3]

            cv2.imwrite(f'IMG/AREA/{name_extracrtedPage}', area)
            cv2.imwrite(f'IMG/NEW/{name_extracrtedPage}', img)



        img_2 = cv2.imread(f'IMG/AREA/{name_extracrtedPage}')

        if img_2:

            cartoon_image = cv2.stylization(img_2, sigma_s=60, sigma_r=0.07)

            cv2.imwrite(f'IMG/AREA/{name_extracrtedPage}', cartoon_image)

            image_path = f"IMG/AREA/{file_name}.png"

            pdf_document = fitz.open(input_pdf_path, filetype='pdf')
            page = pdf_document[0]

            image_pixmap = fitz.Pixmap(image_path)

            page_width_in_pixels = int(page.rect.width / 72.0 * 72)
            page_height_in_pixels = int(page.rect.height / 72.0 * 72)

            kx = x0 / page_width_in_pixels
            ky = y0 / page_height_in_pixels

            x0 //= kx
            y0 //= ky
            x_paste //= kx
            y_paste //= ky

            page.insert_image(

                fitz.Rect(x0=x_paste, y0=y0 - image_pixmap.height // ky - y_paste,
                          x1=x_paste + image_pixmap.width // kx,
                          y1=y0 - image_pixmap.height // ky),
                pixmap=image_pixmap,
                rotate=180,

            )

        img = cv2.imread(f'IMG/INPUT/{name_extracrtedPage}')
        img = cv2.resize(img, (2400, 3600))
        img = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)
        print(img.shape[0], img.shape[1])

        config = 'r--oem 3 --psm 6'

        data = pytesseract.image_to_data(img, config=config, lang='eng')

        input_path = f"IMG/INPUT/{file_name}.pdf"
        output_file = f"IMG/RESULT/{file_name}.pdf"
        image_path = f"IMG/AREA/{file_name}.png"

        pdf_document = fitz.open(input_pdf_path, filetype='pdf')
        page = pdf_document[0]

        page_width_in_pixels = int(page.rect.width / 72.0 * 72)
        page_height_in_pixels = int(page.rect.height / 72.0 * 72)

        kx = x0 / page_width_in_pixels
        ky = y0 / page_height_in_pixels

        x0 //= kx
        y0 //= ky
        x_paste //= kx
        y_paste //= ky

        for i, el in enumerate(data.splitlines()):

            if i == 0:
                continue

            el = el.split()

            try:

                if "@" in el[11]:
                    x, y, w, h = int(el[6]), int(el[7]), int(el[8]), int(el[9])
                    cv2.rectangle(img, (x, y), (x + w, y + h), (0, 0, 255), thickness=cv2.FILLED)
                    e_mail_x_paste, e_mail_y_paste = x, y
                    e_mail_x_paste //= kx
                    e_mail_y_paste //= ky
                    text = el[11]

                    cv2.imwrite(f'IMG/HID/{name_extracrtedPage}', img)

                    area = np.full((h, w, 3), (255, 0, 0), dtype=np.uint8)
                    cv2.imwrite(f'IMG/AREA/{name_extracrtedPage}', area)
                    image_pixmap = fitz.Pixmap(image_path)

                    page.insert_image(

                        fitz.Rect(x0=e_mail_x_paste, y0=y0 - image_pixmap.height * 1.5 - e_mail_y_paste,
                                  x1=e_mail_x_paste + image_pixmap.width // kx, y1=y0 - image_pixmap.height // ky),
                        pixmap=image_pixmap,
                        rotate=180,

                    )

                    ko_vo_of_founded_elems += 1

                if (el[11] in phone_number) or ():
                    x, y, w, h = int(el[6]), int(el[7]), int(el[8]), int(el[9])
                    cv2.rectangle(img, (x, y), (x + w, y + h), (0, 0, 255), thickness=cv2.FILLED)
                    phone_x_paste, phone_y_paste = x, y
                    phone_x_paste //= kx
                    phone_y_paste //= ky
                    text = el[11]

                    cv2.imwrite(f'IMG/HID/{name_extracrtedPage}', img)

                    area = np.full((h, w, 3), (255, 0, 0), dtype=np.uint8)
                    cv2.imwrite(f'IMG/AREA/{name_extracrtedPage}', area)
                    image_pixmap = fitz.Pixmap(image_path)

                    page.insert_image(

                        fitz.Rect(x0=phone_x_paste, y0=y0 - image_pixmap.height * 2 - phone_y_paste,
                                  x1=phone_x_paste + image_pixmap.width // kx, y1=y0 - image_pixmap.height // ky),
                        pixmap=image_pixmap,
                        rotate=180,

                    )

                if ko_vo_of_founded_elems == 6:
                    break

                if "+" in el[11]:
                    x, y, w, h = int(el[6]), int(el[7]), int(el[8]), int(el[9])
                    cv2.rectangle(img, (x, y), (x + w, y + h), (0, 0, 255), thickness=cv2.FILLED)

                print(el)

            except IndexError:

                print("Отсутствие элемента!")

        output_pdf = fitz.open()
        output_pdf.insert_pdf(pdf_document)

        pdf_document.save(output_file)
        pdf_document.close()

        file_name = found_file_name[:-4]
        input_pdf_path = f"IMG/RESULT/{file_name}.pdf"
        output_pdf_path = f"IMG/RESULT/{file_name}.pdf"
        text_to_add = f"{file_name}@example.com"
        page_number = 1

        temp_pdf_path = "temp.pdf"

        pdf_canvas = canvas.Canvas(temp_pdf_path)
        pdf_canvas.drawString(e_mail_x_paste, y0 - e_mail_y_paste, text_to_add)
        pdf_canvas.save()

        existing_pdf = PdfReader(input_pdf_path)
        text_pdf = PdfReader(temp_pdf_path)

        output_pdf = PdfWriter()

        for i in range(len(existing_pdf.pages)):
            if i == page_number - 1:
                page_with_text = text_pdf.pages[0]
                page_with_text.merge_page(existing_pdf.pages[i])
                output_pdf.add_page(page_with_text)
            else:
                output_pdf.add_page(existing_pdf.pages[i])

        with open(output_pdf_path, 'wb') as output_file:
            output_pdf.write(output_file)

        os.remove(temp_pdf_path)

        print(file_name)
else:
    print("Файлы не найдены.")

